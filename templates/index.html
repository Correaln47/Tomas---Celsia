<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Emotion Interaction</title>
    <link rel="stylesheet" href="/static/css/style.css">
  </head>
  <body>
    <div id="main-container">
      
      <div id="faceContainer">
        <canvas id="faceCanvas"></canvas>
        <img id="specialOverlay" src="static/media/Tomas.jpg" alt="Superposición Especial">
      </div>

      <audio id="specialAudio" src="static/media/uso.mp3"></audio>

      <img id="videoFeed" src="/video_feed" alt="Live Video Feed">

      <div id="snapshot-container" style="display:none;">
        <img id="snapshot" src="/snapshot" alt="Detected Snapshot">
        <p id="emotionText"></p>
      </div>
      
      <div id="carousel-container">
        <div id="carousel-track">
          </div>
      </div>
      <div class="power-button-comment">
        <p>Botón de apagado <br> (detrás del robot)</p>
        <div class="arrow">⬇️</div>
      </div>

    </div>

    <div id="video-container">
      <video id="interactionVideo" controls autoplay></video>
    </div>

    <script src="/static/js/script.js"></script>
    
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const carouselContainer = document.getElementById('carousel-container');
        const track = document.getElementById('carousel-track');
        // El servidor donde están los archivos
        const uploadServerUrl = 'http://' + window.location.hostname + ':5002';

        // ### MODIFICADO: Apunta directamente al archivo JSON estático ###
        const jsonUrl = uploadServerUrl + '/static/carousel_images/carousel_data.json';

        console.log('Cargando lista de imágenes desde:', jsonUrl);

        // Fetch para obtener el archivo JSON
        fetch(jsonUrl)
          .then(response => {
            if (!response.ok) {
              // Este error saltará si el archivo no se encuentra (404)
              throw new Error(`No se pudo cargar el archivo de datos: ${response.statusText}`);
            }
            return response.json();
          })
          .then(data => {
            console.log('Imágenes encontradas:', data.images);

            if (data.images && data.images.length > 0) {
              track.innerHTML = ''; // Limpiar el carrusel
              
              // Duplicar imágenes para un bucle suave e infinito
              const imagesToLoad = [...data.images, ...data.images];
              
              imagesToLoad.forEach(imageUrl => {
                const imgElement = document.createElement('img');
                // La URL completa se construye con el origen del servidor de archivos
                imgElement.src = uploadServerUrl + imageUrl; 
                track.appendChild(imgElement);
              });
              
              const animationDuration = data.images.length * 5; // 5s por imagen
              track.style.animation = `scroll ${animationDuration}s linear infinite`;
              carouselContainer.style.display = 'block'; // Mostrar el carrusel

            } else {
              console.log('No hay imágenes en el carrusel, se mantendrá oculto.');
              carouselContainer.style.display = 'none';
            }
          })
          .catch(error => {
              console.error('Error al cargar el carrusel:', error);
              carouselContainer.style.display = 'none';
          });
      });
    </script>
    </body>
</html>